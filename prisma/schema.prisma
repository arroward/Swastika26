generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Event {
  id               String   @id @default(cuid()) @db.VarChar(255)
  title            String   @db.VarChar(255)
  description      String?
  date             DateTime @db.Timestamp()
  location         String?  @db.VarChar(255)
  image_url        String?
  category         String?  @db.VarChar(100)
  capacity         Int?     @default(100)
  registered_count Int?     @default(0)
  created_at       DateTime? @default(now()) @db.Timestamp()
  registration_fee Int?     @default(0)
  is_online        Boolean? @default(false)
  rules            Json?    @default("[]")
  price_amount     Int?     @default(0)

  registrations    EventRegistration[] @relation("EventToRegistrations")
  admin_events     admin_events[]      @relation("EventToAdminEvents")

  @@map("events")
  @@index([date])
}

model EventRegistration {
  id                   Int     @id @default(autoincrement())
  event_id             String  @db.VarChar(255)
  full_name            String  @db.VarChar(255)
  email                String  @db.VarChar(255)
  phone                String? @db.VarChar(20)
  college_name         String? @db.VarChar(255)
  university_name      String? @db.VarChar(255)
  team_size            Int?    @default(1)
  team_members         Json?
  registration_date    DateTime? @default(now()) @db.Timestamp()
  upi_transaction_id   String? @db.VarChar(255)
  account_holder_name  String? @db.VarChar(255)
  upload_file_url      String?

  event                Event   @relation("EventToRegistrations", fields: [event_id], references: [id], onDelete: Cascade)

  @@unique([event_id, email])
  @@map("event_registrations")
  @@index([event_id])
  @@index([email])
}

model Admin {
  id           String  @id @default(cuid()) @db.VarChar(255)
  email        String  @unique @db.VarChar(255)
  password     String  @db.VarChar(255)
  role         String  @db.VarChar(50) // CHECK: role IN ('superadmin', 'event_coordinator')
  name         String  @db.VarChar(255)
  created_at   DateTime? @default(now()) @db.Timestamp()

  admin_events admin_events[] @relation("AdminToAdminEvents")

  @@map("admins")
  @@index([email])
}

model admin_events {
  admin_id String @db.VarChar(255)
  event_id String @db.VarChar(255)

  admin    Admin  @relation("AdminToAdminEvents", fields: [admin_id], references: [id], onUpdate: Cascade, onDelete: Cascade)
  event    Event  @relation("EventToAdminEvents", fields: [event_id], references: [id], onUpdate: Cascade, onDelete: Cascade)

  @@id([admin_id, event_id])
  @@index([admin_id], map: "idx_admin_events_admin_id")
  @@index([event_id], map: "idx_admin_events_event_id")
  @@map("admin_events")
}
